{layout name="layout" /}
<script>
        // 定义获取添加相册控制器地址
        var deleteAlbumController = '{:url('PhotosController/deletePhotos')}';
</script>
<link rel="stylesheet" href="/static/admin/css/uploads.css">
<div class="tpl-page-container tpl-page-header-fixed">


        <div class="tpl-left-nav tpl-left-nav-hover">
            <div class="tpl-left-nav-title">
                Amaze UI 列表
            </div>
            <div class="tpl-left-nav-list">
                <ul class="tpl-left-nav-menu">
                    <li class="tpl-left-nav-item">
                        <a href="{:url('index/index')}" class="nav-link ">
                            <i class="am-icon-home"></i>
                            <span>首页</span>
                        </a>
                    </li>

                    <li class="tpl-left-nav-item">
                        <a href="javascript:;" class="nav-link tpl-left-nav-link-list">
                            <i class="am-icon-table"></i>
                            <span>个人网站</span>
                            <i class="am-icon-angle-right tpl-left-nav-more-ico am-fr am-margin-right"></i>
                        </a>
                        <ul class="tpl-left-nav-sub-menu" style="display: block;">
                            <li>
                                <a href="{:url('AlbumController/albumList')}" >
                                    <i class="am-icon-angle-right"></i>
                                    <span>相册管理</span>
                                    <i class="tpl-left-nav-content tpl-badge-success">
                                    {$album_count}
                                    </i>
                                </a>
                                   <a href="{:url('AlbumController/addAlbum')}">
                                    <i class="am-icon-angle-right"></i>
                                    <span>添加相册</span>
                                    <i class="tpl-left-nav-content tpl-badge-success">
               18
             </i>
                                <a href="{:url('PhotosController/allPhotos')}" class="active">
                                    <i class="am-icon-angle-right"></i>
                                    <span>查看照片</span>
                                    <i class="tpl-left-nav-content tpl-badge-success">
                                    {$photos_count}
                                    </i>
                        

                                        <a href="{:url('Message/messageList')}">
                                            <i class="am-icon-angle-right"></i>
                                            <span>留言列表</span>
                                            <i class="tpl-left-nav-content tpl-badge-primary">
               5
             </i>


                                        </a>
                            </li>
                        </ul>
                    </li>

                    <li class="tpl-left-nav-item">
                        <a href="javascript:;" class="nav-link tpl-left-nav-link-list">
                            <i class="am-icon-wpforms"></i>
                            <span>个人博客</span>
                            <i class="am-icon-angle-right tpl-left-nav-more-ico am-fr am-margin-right tpl-left-nav-more-ico-rotate"></i>
                        </a>
                        <ul class="tpl-left-nav-sub-menu" style="display: none;">
                            <li>

                                <a href="{:url('uploadPhotos')}">
                                    <i class="am-icon-angle-right"></i>
                                    <span>线条表单</span>
                                    <i class="am-icon-star tpl-left-nav-content-ico am-fr am-margin-right"></i>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="tpl-left-nav-item">
                        <a href="javascript:;" class="nav-link tpl-left-nav-link-list">
                            <i class="am-icon-wpforms"></i>
                            <span>心情笔记</span>
                            <i class="am-icon-angle-right tpl-left-nav-more-ico am-fr am-margin-right tpl-left-nav-more-ico-rotate"></i>
                        </a>
                        <ul class="tpl-left-nav-sub-menu" style="display: none;">
                            <li>

                                <a href="{:url('uploadPhotos')}">
                                    <i class="am-icon-angle-right"></i>
                                    <span>线条表单</span>
                                    <i class="am-icon-star tpl-left-nav-content-ico am-fr am-margin-right"></i>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="tpl-left-nav-item">
                        <a href="javascript:;" class="nav-link tpl-left-nav-link-list">
                            <i class="am-icon-wpforms"></i>
                            <span>在线聊天</span>
                            <i class="am-icon-angle-right tpl-left-nav-more-ico am-fr am-margin-right tpl-left-nav-more-ico-rotate"></i>
                        </a>
                        <ul class="tpl-left-nav-sub-menu" style="display: none;">
                            <li>

                                <a href="{:url('uploadPhotos')}">
                                    <i class="am-icon-angle-right"></i>
                                    <span>线条表单</span>
                                    <i class="am-icon-star tpl-left-nav-content-ico am-fr am-margin-right"></i>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="tpl-left-nav-item">
                        <a href="{:url('login')}" class="nav-link tpl-left-nav-link-list">
                            <i class="am-icon-key"></i>
                            <span>登录</span>

                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="tpl-content-wrapper">
            <ol class="am-breadcrumb">
                <li><a href="#" class="am-icon-home">首页</a></li>
                <li><a href="#">个人网站</a></li>
                <li class="am-active">查看照片</li>
            </ol>
            <div class="tpl-portlet-components">
                <div class="portlet-title">
                    <div class="caption font-green bold">
                        <span class="am-icon-code"></span> 相册列表
                    </div>
                </div>
                <div class="tpl-block">
                    <div class="am-g">
                        <div class="am-u-sm-12 am-u-md-6">
                            <div class="am-btn-toolbar">
                                <div class="am-btn-group am-btn-group-ls">
                                    <a><button type="button" id="plus_album" class="am-btn am-btn-default am-btn-success"><span class="am-icon-plus"></span> 添加照片</button></a>
                                </div>
                                <div class="am-btn-group am-btn-group-ls">
                                    <a href="{:url('AlbumController/addAlbum')}"><button type="button"  class="am-btn am-btn-default am-btn-success"><span class="am-icon-plus"></span> 新增相册</button></a>
                                </div>
                            </div>
                        </div>
                        <div class="am-u-sm-12 am-u-md-3">
                            <div class="am-form-group">
                                <select id="album" data-am-selected="{btnSize: 'sm'}">
                                  {volist name="album_data" id="vo"}
                                  <option value="{$vo.a_id}">{$vo.a_title}</option>
                                  {/volist}
                                </select>
                            </div>
                        </div>

                    </div>
                    <div class="am-g">
                        <div id="photos" class="tpl-table-images">
                            {volist name="photos_data" id="vo"}
                            <div  class="am-u-sm-12 am-u-md-6 am-u-lg-4">
                                <div class="tpl-table-images-content">
                                    <span class="tpl-i-title">上传时间</span>
                                    <div class="tpl-table-images-content-i-time">{$vo.p_time}</div>
                                    <div class="tpl-i-title cont ">
                                        {$vo.p_title}
                                    </div>
                                    <img layer-pid="{$vo.p_id}" layer-src="{$vo.p_address}" src="{$vo.p_thum}" alt="{$vo.p_title}">
                                    <div class="tpl-table-images-content-block">
                                        <div class="am-btn-toolbar">
                                            <div class="am-btn-group am-btn-group-xs tpl-edit-content-btn">
                                                <button type="button" class="am-btn am-btn-default am-btn-danger"><span a_id="{$vo.p_id}" name="delete" class="am-icon-trash-o">删除</span></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {/volist}

                            <div class="am-u-lg-12">
                                <div class="am-cf">

                                    <div class="am-fr">
                                       {$photos_data->render()}
                                    </div>
                                </div>
                                <hr>
                            </div>

                        </div>

                    </div>
                </div>
                <div class="tpl-alert"></div>
            </div>
        </div>
    </div>
    <script>
    $("#plus_album").on("click",function(){
        layer.open({
            type: 2,
            title: '添加照片----上传过程中请勿关闭窗口',
            shadeClose: true,
            shade: 0.8,
            area: ['90%', '90%'],
            content: "{:url('PhotosController/uploadLayer')}" //iframe的url
            }); 
      });
    $('#album').change(function(){
        var date_json =  {"a_id":$(this).children('option:selected').val()};
        commonAjax('POST',"{:url('PhotosController/selectAlbum')}",ajaxSuccessFunction,date_json,'json');

    
    });
    function ajaxSuccessFunction(json,id){
        // 判断是否有message键值，如果有代表没有数据
        if(json.hasOwnProperty("message")){
            // 提示用户没有数据
            warning(json.message,json.ico);
            // 退出函数执行
            return false;
        }
        // 有数据先把所有照片清空
        $('#photos').empty();
        // 定义变量用来存储照片信息
        var allPhotos = '';
        // 循环所有的数据并且存储在allPhotos变量中
        for(var i=0,l=json.length;i<l;i++){
             allPhotos += '<div  class="am-u-sm-12 am-u-md-6 am-u-lg-4"><div class="tpl-table-images-content"><span class="tpl-i-title">上传时间</span><div class="tpl-table-images-content-i-time">'+json[i]['p_time']+'</div><div class="tpl-i-title cont ">'+json[i]['p_title']+'</div><img layer-pid="'+json[i]['p_id']+'" layer-src="'+json[i]['p_address']+'" src="'+json[i]['p_thum']+'" alt="'+json[i]['p_title']+'"><div class="tpl-table-images-content-block"><div class="am-btn-toolbar"><div class="am-btn-group am-btn-group-xs tpl-edit-content-btn"><button type="button" class="am-btn am-btn-default am-btn-danger"><span a_id="'+json[i]['p_id']+'" name="delete" class="am-icon-trash-o">删除</span></button></div></div></div></div></div>';
            // for(var key in json[i]){
                
            //     // alert(key+':'+json[i][key]);
            // }
         }
         // 追加到该div下，做到无刷新显示
         $('#photos').append(allPhotos);
         /*
            动态生成的元素添加点击事件
            如果元素是用click事件append进来的
            那功能函数必须放在这个click事件里面。
            同理，在这里的动作是change动作，所以
            这里添加内容里面的点击事件要放在change中
            这里因为内容是动态追加到div中，所以
            该div中的所有点击动作必须要在该change
            动作中，才能实现动态添加元素实现点击事件
         */
         commonNameEvent('span',"delete",'click',nameSuccessFunction);
    }
    //  显示照片查看层 
    var index = layer.photos({
      photos: '#photos'
      ,anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
    });

    </script>
    <script src="/static/admin/js/deleteAlbum.js"></script>